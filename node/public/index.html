<html>

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="js/app.js"></script>
    <link rel="stylesheet" href="css/app.css">

    <script>
        window.onload = function () {
            load_chains().then(() => {
                load_subchains($('#chains').find(":selected").val())
            })
            $('#chains').change(function() {load_subchains($('#chains').find(":selected").val())})
        };

        function load_chains() {
            return get_chains()
                .then(response => response.json())
                .then(chains => {
                    $('#chains').empty()
                    chains.forEach(chain => {
                        $('#chains').append('<option value="' + chain.id + '">' + chain.name + '</option>')
                    })
                })
        }

        function load_subchains(chain) {
            return get_subchains(chain)
                .then(response => response.json())
                .then(subchains => {
                    $('#subchains').empty()
                    subchains.forEach(subchain => {
                        $('#subchains').append('<option value="' + subchain.id + '">' + subchain.name + '</option>')
                    })
                })
        }

        function show_store() {
            chain = $('#chains').find(":selected").val()
            subchain = $('#subchains').find(":selected").val()
            store = $('#store').val()
            get_store(chain, subchain, store)
                .then(response => response.json())
                .then(response => response[0])
                .then(store_data => {
                    $('#store_data').empty()
                    table = $('<table id="store_details">')
                    table.append('<tr><td>Name</td><td>' + store_data.name + '</td></tr>')
                    table.append('<tr><td>City</td><td>' + store_data.city + '</td></tr>')
                    table.append('<tr><td>Address</td><td>' + store_data.address + '</td></tr>')
                    table.append('<tr><td>Zip Code</td><td>' + store_data.zipcode + '</td></tr>')
                    $('#store_data').append(table)
                })
        }
    </script>
</head>

<body>
    Chain: <select id="chains"></select>
    Subchain: <select id="subchains"></select>
    Store: <input id="store">
    <button onclick="show_store()">Get</button>
    <div id="store_data"></div>
</body>
</html>