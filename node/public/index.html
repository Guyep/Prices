<html>

<head>
    <title>Page Title</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="js/app.js"></script>
    <link rel="stylesheet" href="css/app.css">

    <script>
        window.onload = function () {
            load_chains().then(() => {
                load_subchains($('#chains').find(":selected").val())
            })
            $('#chains').change(function() {load_subchains($('#chains').find(":selected").val())})
        };

        function load_chains() {
            return get_chains()
                .then(response => response.json())
                .then(chains => {
                    $('#chains').empty()
                    chains.forEach(chain => {
                        $('#chains').append('<option value="' + chain.id + '">' + chain.name + '</option>')
                    })
                })
        }

        function load_subchains(chain) {
            return get_subchains(chain)
                .then(response => response.json())
                .then(subchains => {
                    $('#subchains').empty()
                    subchains.forEach(subchain => {
                        $('#subchains').append('<option value="' + subchain.id + '">' + subchain.name + '</option>')
                    })
                })
        }

        function show_store() {
            chain = $('#chains').find(":selected").val()
            subchain = $('#subchains').find(":selected").val()
            store = $('#store').val()
            get_store(chain, subchain, store)
                .then(response => response.json())
                .then(response => response[0])
                .then(store_data => {
                    $('#store_data').empty()
                    table = $('<table id="store_details">')
                    table.append('<tr><td>Name</td><td>' + store_data.name + '</td></tr>')
                    table.append('<tr><td>City</td><td>' + store_data.city + '</td></tr>')
                    table.append('<tr><td>Address</td><td>' + store_data.address + '</td></tr>')
                    table.append('<tr><td>Zip Code</td><td>' + store_data.zipcode + '</td></tr>')
                    $('#store_data').append(table)
                })
        }

        /* find the price of specific product
           NEED TO COMPLETE */
        function show_item() {
            itemName = $('#itemName').val()
            get_item(itemName)
            .then(response => response.json())
            .then(items => {
                $('#items').empty()
                list = $('<ol>')
                items.forEach(item => {
                    list.append("<li>Item ID: " + item.id + "Item Name: " + item.name + "</li>")
                })
                $('#items').append(list)
            })
        } 
        
        function update_city_list() {
            const startWith = $('#city').val()
            get_cities_by_prefix(startWith)
            .then(response => response.json())
            .then(cities => {
                $('#cityList').empty()
                cities.forEach(city => {
                    console.log(city.city)
                    $('#cityList').append("<option value=" + city.city + ">")
                })
            })
        }

    </script>    
    </head>

<body>
    <div class="header">
        <h1>Prices</h1>
        <p>This project compares products prices in supermarkets over time.</p>
    </div>
      
    <div class="content">
        <h1>Let's start comparing!</h1>
    </div>

    <div class="content">
        <h2>Stores Details</h2>
    </div> 
      
    <p class="tab">
        Chain <select id="chains" class="selectBox"></select>
        Subchain <select id="subchains" class="selectBox"></select>
        Store ID <input id="store" class="selectBoxNoRghtMarg">
        <button onclick="show_store()" class="button button12px">Get</button>
        <div id="store_data"></div>
    </p>

    <div class="content">
        <h2>Find Stores by City</h2>
    </div> 

    <p class="tab">
        City <input type="text" id="city" name="cities" list="cityList" class="selectBoxNoRghtMarg" oninput="update_city_list()" onkeypress="update_city_list()">    
        <button onclick="show_store_by_city()" class="button button12px">Get</button>
        <datalist id="cityList"> </datalist>
    </p>

    <div class="content">
        <h2>Items Prices Over Time</h2>
    </div>

    <p class="tab">
        Item <input id="itemName" class="selectBoxNoRghtMarg">
        <button onclick="show_item()" class="button button12px">Get</button>
        <div id="items"></div>
    </p>
    
</body>
</html>